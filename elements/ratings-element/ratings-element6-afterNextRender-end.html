<template id="test-template"><div><ratings-element></ratings-element></div></template>

<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">

<dom-module id="ratings-element">
  <template strip-whitespace>
    <style>
      :host {
        display: inline-block;
        cursor: pointer;
        user-select: none;
        font-size: 1.5em;
        margin: 4px;
        padding: 8px;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                0 1px 5px 0 rgba(0, 0, 0, 0.12),
                0 3px 1px -2px rgba(0, 0, 0, 0.2);
      }

      :host > span {
        color: goldenrod;
      }

      :host([rating="1"]) > span:nth-child(1) ~ span,
      :host([rating="2"]) > span:nth-child(2) ~ span,
      :host([rating="3"]) > span:nth-child(3) ~ span,
      :host([rating="4"]) > span:nth-child(4) ~ span {
        color: inherit;
      }

      span {
        padding: 4px 8px;
      }
    </style>
    <span>⭑</span>
    <span>⭑</span>
    <span>⭑</span>
    <span>⭑</span>
    <span>⭑</span>
  </template>
  <script>
    Polymer({

      is: 'ratings-element',

      properties: {
        rating: {
          reflectToAttribute: true, // sets attribute
          notify: true
        }
      },

      ready: function() {
        // defer until after render!
        Polymer.RenderStatus.afterNextRender(this, function() {
          if (this.tabIndex < 0) {
            this.tabIndex = 0;
          }
          if (!this.role) {
            this.role = 'slider';
          }
          this.listen(this, 'down', '_downHandler');
          this.listen(this, 'keydown', '_keyHandler');
        });
      },

      _downHandler: function(e) {
        if (!this._ripple) {
          this._ripple = document.createElement('paper-ripple');
        }
        var i = Array.from(Polymer.dom(this.root).querySelectorAll('span')).indexOf(e.target);
        if (e.target.localName == 'span') {
          e.target.style.position = 'relative';
          Polymer.dom(e.target).appendChild(this._ripple);
          this._ripple.uiDownAction(e);
        }
        this.rating = i + 1;
      },

      _keyHandler: function(e) {
        var current = this.rating || 0;
        if (e.keyCode == 37) {
          this.rating = Math.max(current - 1, 0);
        } else if (e.keyCode == 39) {
          this.rating = Math.min(current + 1, 5);
        }
      }

    });
  </script>
</dom-module>