<template id="test-template"><div><ratings-element></ratings-element></div></template>

<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">

<dom-module id="shadow-card">
  <template strip-whitespace>
    <style>
      :host {
        display: block;
        box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.14),
                  0 1px 5px 0 rgba(0, 0, 0, 0.12),
                  0 3px 1px -2px rgba(0, 0, 0, 0.2);
        padding: 8px;
      }
    </style>
    <content></content>
  </template>
  <script>Polymer({is: 'shadow-card'});</script>
</dom-module>

<dom-module id="ratings-element">
  <template strip-whitespace>
    <style>
      :host {
        display: inline-block;
        cursor: pointer;
        user-select: none;
        font-size: 1.5em;
        margin: 4px;
      }

      .checked {
        color: goldenrod;
      }

      span {
        padding: 4px 8px;
        position: relative;
      }
    </style>
    <shadow-card>
      <span>⭑</span>
      <span>⭑</span>
      <span>⭑</span>
      <span>⭑</span>
      <span>⭑</span>
    </shadow-card>
  </template>
  <script>
    Polymer({

      is: 'ratings-element',

      hostAttributes: { // sets attributes
        tabIndex: 0,
        role: 'slider'
      },

      listeners: { // adds event listeners
        keydown: '_keyHandler',
        down: '_downHandler'
      },

      properties: {
        rating: {
          reflectToAttribute: true, // sets attribute
          notify: true, // sends an event
          observer: '_ratingChanged', // calls this function
          value: 0 // all that happens when this is set
        }
      },

      ready: function() {
        this._ripple = document.createElement('paper-ripple');
      },

      _downHandler: function(e) {
        var i = Array.from(Polymer.dom(this.root).querySelectorAll('span')).indexOf(e.target);
        if (e.target.localName == 'span') {
          Polymer.dom(e.target).appendChild(this._ripple);
          this._ripple.uiDownAction(e);
        }
        this.rating = i + 1;
      },

      _keyHandler: function(e) {
        if (e.keyCode == 37) {
          this.rating = Math.max(this.rating - 1, 0);
        } else if (e.keyCode == 39) {
          this.rating = Math.min(this.rating + 1, 5);
        }
      },

      _ratingChanged: function() {
        Array.from(Polymer.dom(this.root).querySelectorAll('span')).forEach(function(n, i) {
          if (i < this.rating) {
            n.classList.add('checked');
          } else {
            n.classList.remove('checked');
          }
        }, this);
      }

    });
  </script>
</dom-module>